define("wixCodeInit/utils/urlBuilder",[],function(){"use strict";function a(){for(var a=arguments[0],b=1;b<arguments.length;++b)a=a.replace(/\/$/,"")+"/"+arguments[b].replace(/^\//,"");return a}function b(a){return/^https?:\/\/localhost\/?$/.test(a)}function c(a){return/^\d+\.\d+\.\d+$/.test(a)}function d(a,b){var d=a.lastIndexOf("/");return c(b)?a.substring(0,d+1)+b:a}function e(a,c){var e=a.serviceTopology,f=b(a.santaBase)?e.scriptsLocationMap.santa:a.santaBase;return f=d(f,c),f.replace(e.scriptsDomainUrl+"services/","")}function f(b,c,d,f){var g=c.extensionId,h="//"+g+".",i=b.serviceTopology.wixCloudBaseDomain,j=d?"index.debug.html":"index.html",k="static/wixcode/target/"+j,l=e(b,f);return h+a(i,"_partials",l,k)}function g(a){return Object.keys(a).map(function(b){return encodeURIComponent(b)+"="+encodeURIComponent(a[b])}).join("&")}function h(a,b,c){c=c||{};var d=f(a,b,c.debug,c.runtimeSource),e=!!a.publicModel,h={compId:"wixCode_"+b.appDefinitionId,deviceType:c.isMobileView?"mobile":"desktop",viewMode:e?"site":a.renderFlags.componentViewMode||"preview",instance:b.instance,locale:a.rendererModel.languageCode,cacheKiller:(new Date).getTime().toString(),initialScari:a.rendererModel.wixCodeModel?a.rendererModel.wixCodeModel.appRenderInfo:""};c.sdkSource&&(h.sdkSource=c.sdkSource);var i=g(h);return d+"?"+i}return{buildUrl:h}}),define("wixCodeInit/utils/messageHolder",[],function(){"use strict";function a(){var a=[],b=null;return{sendOrHoldMessage:function(c){b?b(c):a.push(c)},setMessageTarget:function(c){for(b=c;a.length>0;)b(a.shift())}}}return{get:a}}),define("wixCodeInit/utils/iFrameUtils",[],function(){"use strict";function a(a,b){var c=document.createElement("iframe");return c.style.display="none",c.src=a,c.className="wix-code-app",c.setAttribute("data-app-id",b.applicationId),c.setAttribute("data-app-definition-id",b.appDefinitionId),c}function b(a,b){return b.source===a.contentWindow}return{getIFrameForApp:a,isIFrameEvent:b}}),define("wixCodeInit/utils/widgetsPreLoader",[],function(){"use strict";function a(a){if(null===a||"object"!=typeof a)return a;var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function b(a,b,c,d){requirejs(["utils","widgets","wixCode"],function(e,f,g){var h=d(e),i=e.wixUrlParser.parseUrl(h,a),j=i&&i.pageId;if(j){var k=b(f,h,j),l=g.messageBuilder.getExtendedMessage(k,h.rendererModel.wixCodeModel||{});c(l)}})}function c(a,c,d){var e=function(b,c,d){var e=b.appsUtils.getApplications(a.rendererModel.clientSpecMap,[d],c);return b.messageBuilder.loadWidgetsMessage(e)},f=function(b){return new b.SiteData(a,function(){})};b(c,e,d,f)}function d(a,c,d){var e=function(a,b,c){var d=a.widgetService.getControllersToInit(b,c);return a.messageBuilder.initWidgetsMessage(c,d)},f=function(){return a};b(c,e,d,f)}function e(b,c){if("load_widgets"===c.type){var d=b.widgets.map(function(a){return a.id});if(d.length>0&&(c=a(c),c.widgets=c.widgets.filter(function(a){return-1===d.indexOf(a.id)}),0===c.widgets.length))return null}return c}return{asyncGetPreLoadMessage:c,asyncGetPreInitMessage:d,filterPreLoadedWidgets:e}}),define("wixCodeInit/utils/specMapUtils",[],function(){"use strict";function b(b){for(var c in b)if(b.hasOwnProperty(c)&&b[c].type===a)return b[c]}var a="siteextension";return{getAppSpec:b}}),define("wixCodeInit/api/wixCodeAppApi",["wixCodeInit/utils/urlBuilder","wixCodeInit/utils/messageHolder","wixCodeInit/utils/iFrameUtils","wixCodeInit/utils/widgetsPreLoader","wixCodeInit/utils/specMapUtils","experiment"],function(a,b,c,d,e,f){"use strict";function g(a){return"WIX_CODE"===a.intent&&"wix_code_iframe_loaded"===a.type}function h(a){"loading"!==document.readyState?document.body.appendChild(a):document.addEventListener("DOMContentLoaded",function(){document.body.appendChild(a)})}function i(){function q(a,b){c.isIFrameEvent(a,b)&&(g(b.data)&&l.setMessageTarget(function(b){a.contentWindow.postMessage(b,"*")}),j.forEach(function(a){a(b.data)}))}function r(b,d,f){if(m)return void console.warn("Wix code is already initiated");var g=e.getAppSpec(d);if(g){var i=a.buildUrl(b,g,f),j=c.getIFrameForApp(i,g),k=q.bind(null,j);window.addEventListener("message",k,!1),h(j),m=!0}}function s(a){j.push(a)}function t(a){k.push(a)}function u(a){var b=a;return k.forEach(function(a){b=a(b)}),b}function v(a){n&&(a=o?d.filterPreLoadedWidgets(o,a):a),a&&l.sendOrHoldMessage(u(a)),n=!1}function w(a,b){var c=e.getAppSpec(a.rendererModel.clientSpecMap);n&&!o&&c&&d.asyncGetPreLoadMessage(a,b,function(a){n&&!o&&(o=a,l.sendOrHoldMessage(o))})}function x(a,b){var c=e.getAppSpec(a.rendererModel.clientSpecMap);n&&!p&&c&&d.asyncGetPreInitMessage(a,b,function(a){n&&!p&&(p=a,l.sendOrHoldMessage(p))})}if(!f.isOpen("wixCodeBinding")){var i=function(){};return{init:i,sendMessage:i,registerMessageHandler:i,registerMessageModifier:i,preLoadWidgets:i}}var j=[],k=[],l=b.get(),m=!1,n=!0,o=null,p=null;return{init:r,sendMessage:v,registerMessageHandler:s,registerMessageModifier:t,preLoadWidgets:w,preInitWidgets:x}}return{getApi:i}}),define("wixCodeInit/api/initMainR",["wixCodeInit/utils/specMapUtils","experiment"],function(a,b){"use strict";function c(c,d,e,f,g){function k(b){c.init(d,b,h),i&&a.getAppSpec(b)&&c.preLoadWidgets(d,document.location.href)}if(b.isOpen("wixCodeBinding")){var h={isMobileView:e,debug:f.getParameterByName("debug"),sdkSource:f.getParameterByName("sdkSource"),runtimeSource:f.getParameterByName("WixCodeRuntimeSource")},i=!!d.publicModel,j=g&&i&&"success"!==d.dynamicModelState;j?g(function(a){k(a.clientSpecMap)},function(){console.error("Error fetching dynamic client spec map model")}):k(d.rendererModel.clientSpecMap)}}return c}),define("wixCodeInit",["wixCodeInit/api/wixCodeAppApi","wixCodeInit/api/initMainR","wixCodeInit/utils/specMapUtils"],function(a,b,c){"use strict";return{getAppApi:a.getApi,initMainR:b,specMapUtils:c}});